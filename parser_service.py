# –≠—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å —Ç–∞–π–º–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞
# –ø–∞—Ä—Å–µ—Ä–∞ —á—Ç–æ–±—ã –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –∑–∞–ø—Ä–æ—Å–∏–ª–∏ –∑–∞–ø—Ä–æ—Å
# (–∞ –µ–≥–æ —è –±–ª–æ–∫–∞—é(—Ö–∑ —É–±—Ä–∞–ª —è —ç—Ç–æ –≤ –∫–æ–Ω–µ—á–Ω–æ–π –≤–µ—Ä—Å–∏–∏) –∏ –æ—Å—Ç–∞–≤–ª—è—é —Ç–æ–ª—å–∫–æ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã–º –∞–¥–º–∏–Ω–∞–º)
# –±–æ—Ç–∞ –Ω–∞—Ö –Ω–µ —É–±–∏–ª–æ, –∞ —Ç–æ—á–Ω–µ–µ –±–æ—Ç –ø–µ—Ä–µ–∂–∏–≤–µ—Ç
# –Ω–æ –≤–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–º—Ä–µ—Ç —Å–æ —Å—Ç–∞—Ä–æ—Å—Ç–∏
# –∫–æ–≥–¥–∞ –µ–≥–æ —Å—Ä–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è( –≤ –ø–æ—Ä—è–¥–∫–µ –æ—á–µ—Ä–µ–¥–∏ ) –∫–æ—Ç–æ—Ä–æ–µ –≤ —Å—Ä–µ–¥–Ω–µ–º –æ–∫–æ–ª–æ 3-5 –º–∏–Ω



import schedule
import time
from database import db_manager
from parser import parse_table_for_service  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞

GUILD_URLS = {
    "–§–∏–ª–ª–∏–∞–ª": "https://remanga.org/guild/phillial/settings/donations",
    "–ò–≥–≥–¥—Ä–∞—Å–∏–ª—å": "https://remanga.org/guild/i-g-g-d-r-a-s-i-l--a1172e3f/settings/donations"
}


def scheduled_parsing():
    """–ü–∞—Ä—Å–∏—Ç –≤—Å–µ –≥–∏–ª—å–¥–∏–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"""
    print(f"üîÑ –ù–∞—á–∞–ª–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ {time.strftime('%H:%M:%S')}")

    for guild_name, url in GUILD_URLS.items():
        try:
            print(f"üìä –ü–∞—Ä—Å–∏–º {guild_name}...")
            df = parse_table_for_service(url)

            if not df.empty:
                db_manager.save_to_iggdrasil(df)
                print(f"‚úÖ {guild_name}: {len(df)} –∑–∞–ø–∏—Å–µ–π")
            else:
                print(f"‚ùå {guild_name}: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")

        except Exception as e:
            print(f"üö® –û—à–∏–±–∫–∞ –≤ {guild_name}: {e}")


# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
schedule.every(10).minutes.do(scheduled_parsing)

print("üöÄ –°–µ—Ä–≤–∏—Å –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–ø—É—â–µ–Ω! –ü–∞—Ä—Å–∏–º –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç...")

# –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
while True:
    schedule.run_pending()
    time.sleep(60)  # –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É